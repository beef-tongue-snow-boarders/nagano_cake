<div class="container mt-5">
  <div class="row">
    <div class=" col-md-8 mx-auto">
      <% if current_customer.cart_items.present? %>

       <h2>ショッピングカート</h2>
       <p class="text-right"><%= link_to "カートを空にする", cart_items_all_destroy_path,method: :delete, "data-confirm" => "全て削除しますか？" %></p>
       <table class="table table-borderless border-top border-bottom">
        <thead align="center">
          <tr>
            <th></th>
            <th>商品名</th>
            <th>単価</th>
            <th class="text-center">数量</th>
            <th>小計</th>
            <th></th>
          </tr>
        </thead>
       <% total = 0 %>
        <% @cart_items.each do |cart_item| %>
        <tbody align="center">
          <tr>
            <td><%= image_tag cart_item.item.get_image(60,60) %></td>
            <td><%= cart_item.item.name %></td>
            <td>¥<%= (cart_item.item.add_tax_price).to_i.to_s(:delimited) %></td>
            <td>
              <%= form_with model: cart_item, url: cart_item_path(cart_item),method: :patch, local: true do |f| %>
               <%= f.number_field :amount, min: 1, max: 10, id: "amount_cart" %>
               <%= f.submit "変更", class: 'btn btn-success btn-sm' %>
              <% end %>
            </td>
            <td>
               <% subtotal = ((cart_item.item.price*cart_item.amount)*1.10).to_i %>
              ¥<%= subtotal.round.to_s(:delimited) %>
            </td>
            <td>
              <%= link_to "削除",cart_item_path(cart_item.id,cart_item), method: :delete, "data-confirm" => "削除しますか？" %>
            </td>
          </tr>
           <% total += subtotal %>
        </tbody>
       <% end %>
       </table>

       <h4 class="text-right mr-2 mt-5">合計　¥<%= total.round.to_s(:delimited) %></h4>
       <div class="mt-5 text-center">
        <span><%= link_to "買い物を続ける",root_path, class: 'btn btn-outline-secondary mr-2' %></span>
        <span><%=link_to "情報入力画面へ進む", new_order_path, class: 'btn btn-success ml-2' %></span>
       </div>

      <% else %>
      <div class="text-center">
        <p class="mb-5">カート内に商品はありません</p>
        <%= link_to "買い物を続ける",root_path, class: 'btn btn-primary' %>
      </div>

      <% end %>

    </div>
  </div>
</div>
